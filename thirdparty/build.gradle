task cmakeOpencv(group: "opencv") {
    doLast {
        new File("opencv/build").mkdirs()
        exec {
            workingDir "opencv/build"
            commandLine 'cmake',
                    '-D', 'BUILD_TESTS=OFF',
                    '-D', 'BUILD_PERF_TESTS=OFF',
                    '-D', 'BUILD_opencv_python2=OFF',
                    '-D', 'BUILD_opencv_python3=OFF',
                    '-D', 'BUILD_opencv_stitching=OFF',
                    '-D', 'BUILD_opencv_videostab=OFF',
                    '..'
        }
    }
    //TODO Do we need superres module? And modules under windows
}

task compileOpencv(group: "opencv", dependsOn: "cmakeOpencv") {
    doLast {
        println "Building Opencv with "+buildCores+" Cores"
        exec {
            workingDir = "opencv/build"
            commandLine 'make', '-j'+buildCores
        }
        println "Copying files to lib"
        copy {
            from "opencv/build/lib/libopencv_java331.so"
            into "../lib/opencv/"
        }
        copy {
            from "opencv/build/bin/opencv-331.jar"
            into "../lib/opencv/"
        }
    }
}
